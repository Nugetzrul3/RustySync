// Core logic for file watching